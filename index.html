<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swastik Dairy Farm - Pure & Fresh</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts (Premium Look) -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'farm-green': '#15803d', 
                        'farm-dark': '#14532d',
                        'farm-light': '#f0fdf4',
                        'cow-white': '#FAFAFA',
                    },
                    fontFamily: {
                        sans: ['Plus Jakarta Sans', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                    boxShadow: {
                        'soft': '0 10px 40px -10px rgba(0,0,0,0.08)',
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.07)',
                    }
                }
            }
        }
    </script>

    <style>
        body { scroll-behavior: smooth; background-color: #F8FAF9; }
        
        /* Hero Overlay */
        .hero-overlay { background: linear-gradient(to bottom, rgba(0,0,0,0.2), rgba(0,0,0,0.6)); }
        
        /* Smooth Animations */
        .product-card { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .product-card:hover { transform: translateY(-8px); box-shadow: 0 20px 30px -5px rgba(21, 128, 61, 0.15); }
        
        /* Badge Pop */
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.3); } 100% { transform: scale(1); } }
        .animate-pop { animation: pop 0.3s ease-in-out; }
        
        /* Hide Scrollbar */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Modal Animation - Centered & Scaled */
        @keyframes modalEnter {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .modal-content { animation: modalEnter 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        /* Mobile Menu */
        #mobile-menu { transition: all 0.3s ease-in-out; max-height: 0; opacity: 0; overflow: hidden; }
        #mobile-menu.open { max-height: 400px; opacity: 1; }
    </style>
</head>
<body class="text-gray-800 font-sans antialiased selection:bg-farm-green selection:text-white">

    <!-- Navigation -->
    <nav class="fixed w-full z-50 bg-white/90 backdrop-blur-xl border-b border-gray-100 transition-all duration-300" id="navbar">
        <div class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <!-- Mobile Menu Button -->
                <button onclick="toggleMobileMenu()" class="md:hidden text-gray-600 focus:outline-none p-2 hover:bg-gray-100 rounded-lg transition">
                    <i class="fa-solid fa-bars text-xl"></i>
                </button>

                <!-- Logo Section -->
                <a href="#" class="flex items-center gap-3 group">
                    <div class="h-14 w-14 md:h-16 md:w-16 relative transition-transform duration-300 group-hover:scale-105">
                        <img src="swastik_logo.png" alt="Swastik Dairy Logo" 
                             onerror="this.style.display='none'; document.getElementById('fallback-logo').style.display='flex';" 
                             class="h-full w-full object-contain hidden drop-shadow-sm" id="main-logo-img">
                        <div id="fallback-logo" class="h-full w-full bg-farm-green rounded-xl flex items-center justify-center text-white text-3xl shadow-lg">
                            <i class="fa-solid fa-cow"></i>
                        </div>
                    </div>
                    <div>
                        <h1 class="text-xl md:text-2xl font-bold text-gray-900 font-serif tracking-tight">Swastik Dairy</h1>
                        <p class="text-[10px] md:text-xs text-farm-green font-bold tracking-widest uppercase">Pure Village Freshness</p>
                    </div>
                </a>

                <!-- Desktop Menu -->
                <div class="hidden md:flex items-center gap-8 font-medium text-gray-500 text-sm">
                    <a href="#home" class="hover:text-farm-green transition">Home</a>
                    <a href="#about" class="hover:text-farm-green transition">Our Farm</a>
                    <a href="#products" class="hover:text-farm-green transition">Products</a>
                </div>

                <!-- Cart Icon -->
                <div class="flex items-center gap-3 md:gap-4">
                    <button onclick="toggleCart()" class="relative p-2.5 text-gray-700 hover:text-farm-green transition group">
                        <i class="fa-solid fa-bag-shopping text-2xl"></i>
                        <span id="cart-count" class="absolute -top-1 -right-1 bg-farm-green text-white text-[10px] font-bold w-5 h-5 flex items-center justify-center rounded-full opacity-0 transition-opacity duration-300 shadow-md border-2 border-white">0</span>
                    </button>
                </div>
            </div>

            <!-- Mobile Menu Dropdown -->
            <div id="mobile-menu" class="md:hidden bg-white border-t border-gray-100 shadow-soft rounded-b-2xl mt-3 absolute left-0 right-0 w-full px-4">
                <div class="flex flex-col py-2 space-y-1">
                    <a href="#home" onclick="toggleMobileMenu()" class="p-3 rounded-xl text-gray-600 font-medium hover:bg-green-50 hover:text-farm-green transition">Home</a>
                    <a href="#about" onclick="toggleMobileMenu()" class="p-3 rounded-xl text-gray-600 font-medium hover:bg-green-50 hover:text-farm-green transition">Our Farm</a>
                    <a href="#products" onclick="toggleMobileMenu()" class="p-3 rounded-xl text-gray-600 font-medium hover:bg-green-50 hover:text-farm-green transition">Products</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="home" class="relative h-[85vh] min-h-[600px] flex items-center justify-center overflow-hidden">
        <div class="absolute inset-0 z-0">
            <img src="WhatsApp Image 2025-11-29 at 10.05.06 (1).jpeg" alt="Cow and Calf" class="w-full h-full object-cover scale-105 animate-slow-zoom">
            <div class="absolute inset-0 hero-overlay backdrop-blur-[1px]"></div>
        </div>

        <div class="relative z-10 container mx-auto px-4 text-center text-white mt-16">
            <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-white/10 backdrop-blur-md border border-white/20 mb-6 animate-fade-in-up">
                <span class="w-2 h-2 rounded-full bg-green-400 animate-pulse"></span>
                <span class="text-xs font-bold tracking-wider uppercase">100% Organic & Pure</span>
            </div>
            <h1 class="text-4xl md:text-6xl lg:text-7xl font-serif font-bold mb-6 leading-tight drop-shadow-2xl tracking-tight">
                Taste the Purity of <br> <span class="text-transparent bg-clip-text bg-gradient-to-r from-green-300 to-emerald-200">Village Life</span>
            </h1>
            <p class="text-lg md:text-xl text-gray-200 max-w-2xl mx-auto mb-10 font-light leading-relaxed">
                Fresh Milk, Desi Ghee, Curd, and Lassi delivered straight from our farm to your table.
            </p>
            <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
                <a href="#products" class="w-full sm:w-auto px-8 py-4 bg-farm-green hover:bg-green-600 text-white rounded-full font-bold transition shadow-lg shadow-green-900/20 text-lg flex items-center justify-center gap-2">
                    <i class="fa-solid fa-basket-shopping"></i> Shop Fresh
                </a>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section id="features" class="py-20 bg-white">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Feature 1 -->
                <div class="bg-farm-light/50 p-8 rounded-3xl hover:bg-white border border-transparent hover:border-gray-100 shadow-sm hover:shadow-glass transition group">
                    <div class="w-14 h-14 bg-white rounded-2xl flex items-center justify-center text-2xl text-farm-green shadow-sm mb-6 group-hover:scale-110 transition duration-300">
                        <i class="fa-solid fa-leaf"></i>
                    </div>
                    <h3 class="text-lg font-bold mb-2 text-gray-900">100% Natural</h3>
                    <p class="text-gray-500 text-sm leading-relaxed">No chemicals, no preservatives. Just pure produce.</p>
                </div>
                <!-- Feature 2 -->
                <div class="bg-blue-50/50 p-8 rounded-3xl hover:bg-white border border-transparent hover:border-gray-100 shadow-sm hover:shadow-glass transition group">
                    <div class="w-14 h-14 bg-white rounded-2xl flex items-center justify-center text-2xl text-blue-600 shadow-sm mb-6 group-hover:scale-110 transition duration-300">
                        <i class="fa-solid fa-droplet"></i>
                    </div>
                    <h3 class="text-lg font-bold mb-2 text-gray-900">Hygienic Process</h3>
                    <p class="text-gray-500 text-sm leading-relaxed">Milked and packed with care and standards.</p>
                </div>
                <!-- Feature 3 -->
                <div class="bg-yellow-50/50 p-8 rounded-3xl hover:bg-white border border-transparent hover:border-gray-100 shadow-sm hover:shadow-glass transition group">
                    <div class="w-14 h-14 bg-white rounded-2xl flex items-center justify-center text-2xl text-yellow-600 shadow-sm mb-6 group-hover:scale-110 transition duration-300">
                        <i class="fa-solid fa-cow"></i>
                    </div>
                    <h3 class="text-lg font-bold mb-2 text-gray-900">Happy Cows</h3>
                    <p class="text-gray-500 text-sm leading-relaxed">Our cattle are fed organic fodder and loved.</p>
                </div>
                <!-- Feature 4 -->
                <div class="bg-purple-50/50 p-8 rounded-3xl hover:bg-white border border-transparent hover:border-gray-100 shadow-sm hover:shadow-glass transition group">
                    <div class="w-14 h-14 bg-white rounded-2xl flex items-center justify-center text-2xl text-purple-600 shadow-sm mb-6 group-hover:scale-110 transition duration-300">
                        <i class="fa-solid fa-truck-fast"></i>
                    </div>
                    <h3 class="text-lg font-bold mb-2 text-gray-900">Farm to Home</h3>
                    <p class="text-gray-500 text-sm leading-relaxed">Direct delivery ensuring maximum freshness.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="py-20 bg-gray-50 overflow-hidden">
        <div class="container mx-auto px-4">
            <div class="flex flex-col lg:flex-row items-center gap-12 lg:gap-20">
                <div class="w-full lg:w-1/2 relative order-2 lg:order-1">
                    <div class="absolute -top-10 -left-10 w-40 h-40 bg-green-200 rounded-full opacity-20 blur-3xl"></div>
                    <div class="absolute -bottom-10 -right-10 w-40 h-40 bg-yellow-200 rounded-full opacity-20 blur-3xl"></div>
                    <img src="WhatsApp Image 2025-11-29 at 10.05.05 (1).jpeg" alt="Our Cows" class="relative z-10 w-full rounded-[2.5rem] shadow-2xl transform rotate-1 hover:rotate-0 transition duration-700 object-cover aspect-[4/3]">
                </div>
                <div class="w-full lg:w-1/2 order-1 lg:order-2">
                    <h4 class="text-farm-green font-bold tracking-widest uppercase text-xs mb-3">Our Story</h4>
                    <h2 class="text-3xl md:text-5xl font-serif font-bold text-gray-900 mb-6 leading-tight">Rooted in Tradition, <br>Delivering Health.</h2>
                    <p class="text-gray-600 mb-6 leading-relaxed text-lg">
                        At <strong>Swastik Dairy Farm</strong>, we believe that good health starts with good food. Located in the heart of the village, our farm is dedicated to bringing you the authentic taste of rural India.
                    </p>
                    <div class="grid grid-cols-2 gap-8 pt-6">
                        <div>
                            <h5 class="text-4xl font-bold text-gray-900">100+</h5>
                            <p class="text-sm text-gray-500 font-medium mt-1">Happy Cattle</p>
                        </div>
                        <div>
                            <h5 class="text-4xl font-bold text-gray-900">500+</h5>
                            <p class="text-sm text-gray-500 font-medium mt-1">Daily Customers</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Products Section -->
    <section id="products" class="py-24 bg-white">
        <div class="container mx-auto px-4">
            <div class="text-center mb-16">
                <h2 class="text-4xl font-serif font-bold text-gray-900 mb-4">Our Fresh Products</h2>
                <p class="text-gray-500 max-w-2xl mx-auto">Pure, unadulterated goodness from our family to yours.</p>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8" id="product-grid">
                <!-- Products will be injected here by JS -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white pt-20 pb-10 rounded-t-[3rem] mt-10">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between gap-12 mb-16">
                <div class="max-w-sm">
                    <h2 class="text-3xl font-serif font-bold text-white mb-4">Swastik Dairy Farm</h2>
                    <p class="text-gray-400 text-sm leading-relaxed">Bringing the purity of village dairy straight to your modern home. Freshness guaranteed.</p>
                </div>
                
                <div class="flex flex-col gap-6">
                    <h3 class="font-bold text-lg">Connect With Us</h3>
                    <div class="flex gap-4">
                        <a href="#" class="w-12 h-12 rounded-full bg-gray-800 flex items-center justify-center hover:bg-farm-green transition hover:-translate-y-1"><i class="fa-brands fa-facebook-f"></i></a>
                        <a href="#" class="w-12 h-12 rounded-full bg-gray-800 flex items-center justify-center hover:bg-farm-green transition hover:-translate-y-1"><i class="fa-brands fa-instagram"></i></a>
                        <a href="https://wa.me/919812186467" class="w-12 h-12 rounded-full bg-gray-800 flex items-center justify-center hover:bg-green-500 transition hover:-translate-y-1"><i class="fa-brands fa-whatsapp"></i></a>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-800 pt-8 text-center text-gray-600 text-sm">
                &copy; 2025 Swastik Dairy Farm. All rights reserved.
            </div>
        </div>
    </footer>

    <!-- Cart Sidebar Modal -->
    <div id="cart-modal" class="fixed inset-0 z-[60] hidden">
        <div class="absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity" onclick="toggleCart()"></div>
        <div class="absolute right-0 top-0 h-full w-full max-w-md bg-white shadow-2xl transform transition-transform duration-300 translate-x-full flex flex-col" id="cart-panel">
            <div class="p-6 border-b border-gray-100 flex justify-between items-center bg-white">
                <h3 class="text-xl font-bold text-gray-900 flex items-center gap-2">Your Cart</h3>
                <button onclick="toggleCart()" class="text-gray-400 hover:text-gray-900 transition p-2 hover:bg-gray-100 rounded-full"><i class="fa-solid fa-times text-lg"></i></button>
            </div>
            <div class="flex-1 overflow-y-auto p-6 space-y-6 no-scrollbar bg-white" id="cart-items"></div>
            <div class="p-6 border-t border-gray-100 bg-gray-50/50">
                <div class="flex justify-between items-center mb-6">
                    <span class="text-gray-500">Subtotal</span><span id="cart-total" class="text-2xl font-bold text-gray-900">â‚¹0</span>
                </div>
                <button onclick="openCustomerForm()" id="checkout-btn" disabled class="w-full bg-gray-900 hover:bg-farm-green disabled:bg-gray-300 disabled:cursor-not-allowed text-white py-4 rounded-xl font-bold shadow-lg transition flex items-center justify-center gap-2 text-base">
                    Proceed to Checkout <i class="fa-solid fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Customer Info Modal (Step 1) - FIXED MOBILE SCROLLING -->
    <div id="customer-modal" class="fixed inset-0 z-[70] hidden flex items-center justify-center px-4 py-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeCustomerForm()"></div>
        <div class="bg-white rounded-3xl p-8 max-w-md w-full relative z-10 shadow-2xl modal-content max-h-[90vh] overflow-y-auto no-scrollbar flex flex-col">
            <button onclick="closeCustomerForm()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition z-20 bg-white">
                <i class="fa-solid fa-times"></i>
            </button>
            <div class="mb-6 mt-2">
                <span class="text-xs font-bold text-farm-green uppercase tracking-widest">Step 1 of 2</span>
                <h3 class="text-2xl font-serif font-bold text-gray-900 mt-1">Delivery Details</h3>
            </div>
            <!-- Loading Spinner -->
            <div id="loading-spinner" class="hidden absolute inset-0 bg-white/80 backdrop-blur-sm flex items-center justify-center rounded-3xl z-30">
                <div class="flex flex-col items-center">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-farm-green"></div>
                    <p class="mt-4 text-farm-green font-semibold">Creating Order...</p>
                </div>
            </div>
            <form id="customer-form" onsubmit="submitCustomerDetails(event)" class="space-y-4 pb-2">
                <div class="space-y-1">
                    <label class="text-sm font-semibold text-gray-700">Full Name</label>
                    <input type="text" id="cust-name" required class="w-full px-4 py-3 rounded-xl bg-gray-50 border border-gray-200 focus:border-farm-green focus:bg-white outline-none transition" placeholder="John Doe">
                </div>
                <div class="space-y-1">
                    <label class="text-sm font-semibold text-gray-700">Phone Number</label>
                    <input type="tel" id="cust-phone" required class="w-full px-4 py-3 rounded-xl bg-gray-50 border border-gray-200 focus:border-farm-green focus:bg-white outline-none transition" placeholder="98XXXXXXXX">
                </div>
                <div class="space-y-1">
                    <label class="text-sm font-semibold text-gray-700">Address</label>
                    <textarea id="cust-address" required rows="2" class="w-full px-4 py-3 rounded-xl bg-gray-50 border border-gray-200 focus:border-farm-green focus:bg-white outline-none transition resize-none" placeholder="Flat No, Building, Area..."></textarea>
                </div>
                <button type="submit" id="submit-btn" class="w-full bg-gray-900 hover:bg-farm-green text-white py-4 rounded-xl font-bold shadow-lg transition mt-4 mb-2">Proceed to Payment</button>
            </form>
        </div>
    </div>

    <!-- Payment Modal (Step 2) - RESTORED QR CODE -->
    <div id="payment-modal" class="fixed inset-0 z-[80] hidden flex items-center justify-center px-4 py-4">
        <div class="absolute inset-0 bg-black/70 backdrop-blur-md" onclick="closePayment()"></div>
        <div class="bg-white rounded-3xl p-0 max-w-sm w-full relative z-10 text-center shadow-2xl modal-content overflow-hidden max-h-[90vh] overflow-y-auto no-scrollbar">
            <div class="bg-gray-50 p-6 border-b border-gray-100 relative sticky top-0 z-20">
                <button onclick="closePayment()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-900 transition"><i class="fa-solid fa-times text-lg"></i></button>
                <div class="inline-block bg-green-100 text-farm-green px-3 py-1 rounded-full text-xs font-bold mb-2 animate-pulse">ORDER CREATED</div>
                <h3 class="text-xl font-bold text-gray-900">Scan & Pay</h3>
                <p class="text-sm text-gray-500 font-mono">Order ID: <span id="display-order-id" class="font-bold text-gray-900">...</span></p>
            </div>
            <div class="p-6">
                <p class="text-gray-500 text-xs font-bold uppercase tracking-widest mb-1">Total Amount</p>
                <p id="payment-total" class="text-4xl font-bold text-gray-900 mb-6">â‚¹0</p>

                <!-- QR Card - RESTORED -->
                <div class="bg-white p-3 rounded-2xl border border-gray-200 shadow-soft mx-auto w-64 mb-6 relative group">
                    <img src="WhatsApp Image 2025-11-28 at 20.43.37.jpeg" class="w-full h-full object-contain rounded-xl">
                    <div class="mt-2 flex justify-between items-center bg-gray-50 px-3 py-2 rounded-lg">
                        <span class="text-[10px] text-gray-500 font-mono truncate" id="upi-id-text">swastik.farms724@kotak</span>
                        <button onclick="copyUPI()" class="text-farm-green text-xs font-bold hover:underline">COPY</button>
                    </div>
                </div>

                <!-- UPI Apps Mockup -->
                <div class="mb-6">
                    <p class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-3">Or Pay Via</p>
                    <div class="grid grid-cols-4 gap-2">
                        <a id="btn-gpay" href="#" class="bg-gray-50 p-2 rounded-xl border hover:border-farm-green transition flex items-center justify-center h-12"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/f2/Google_Pay_Logo.svg/512px-Google_Pay_Logo.svg.png" class="h-4 object-contain"></a>
                        <a id="btn-phonepe" href="#" class="bg-gray-50 p-2 rounded-xl border hover:border-farm-green transition flex items-center justify-center h-12"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/71/PhonePe_Logo.svg/1200px-PhonePe_Logo.svg.png" class="h-4 object-contain"></a>
                        <a id="btn-paytm" href="#" class="bg-gray-50 p-2 rounded-xl border hover:border-farm-green transition flex items-center justify-center h-12"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/24/Paytm_Logo_%28standalone%29.svg/512px-Paytm_Logo_%28standalone%29.svg.png" class="h-3 object-contain"></a>
                        <a id="btn-bhim" href="#" class="bg-gray-50 p-2 rounded-xl border hover:border-farm-green transition flex items-center justify-center h-12"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/67/BHIM_Logo.svg/512px-BHIM_Logo.svg.png" class="h-4 object-contain"></a>
                    </div>
                </div>

                <div class="bg-yellow-50 border border-yellow-100 rounded-xl p-3 mb-4 text-left flex gap-3 items-start">
                    <i class="fa-solid fa-camera text-yellow-600 mt-1"></i>
                    <p class="text-xs text-yellow-800 leading-snug"><strong>Required:</strong> Take a screenshot of your payment and send it on WhatsApp to confirm.</p>
                </div>

                <a id="whatsapp-confirm" href="#" target="_blank" onclick="clearCartAndClose()" class="block w-full bg-[#25D366] hover:bg-[#128C7E] text-white py-4 rounded-xl font-bold shadow-lg transition flex items-center justify-center gap-2">
                    <i class="fa-brands fa-whatsapp text-xl"></i> Verify on WhatsApp
                </a>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-6 py-3 rounded-full shadow-2xl opacity-0 pointer-events-none transition-opacity duration-300 z-[100] text-sm font-medium">UPI ID Copied!</div>

    <!-- Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        // Fixed import: setLogLevel removed as it was causing issues and isn't critical
        import { getFirestore, addDoc, collection } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Configuration
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : '';
        
        let db, auth;

        window.onload = function() {
            // Init Firebase
            if (Object.keys(firebaseConfig).length > 0) {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                const signIn = async () => {
                    try {
                        if (initialAuthToken) await signInWithCustomToken(auth, initialAuthToken);
                        else await signInAnonymously(auth);
                        console.log("DB Ready");
                    } catch (e) { console.error("Auth Fail", e); }
                };
                signIn();
            }

            // Init UI
            const logoImg = document.getElementById('main-logo-img');
            if (logoImg && logoImg.complete && logoImg.naturalHeight !== 0) {
                logoImg.classList.remove('hidden');
                document.getElementById('fallback-logo').style.display = 'none';
            } else {
                if(logoImg) logoImg.classList.add('hidden');
                document.getElementById('fallback-logo').style.display = 'flex';
            }
            document.getElementById('product-grid').innerHTML = renderProducts();
        };

        // --- Core Functions ---
        window.toggleMobileMenu = () => document.getElementById('mobile-menu').classList.toggle('open');
        window.toggleCart = () => {
            const m = document.getElementById('cart-modal'), p = document.getElementById('cart-panel');
            if (m.classList.contains('hidden')) { m.classList.remove('hidden'); setTimeout(() => p.classList.remove('translate-x-full'), 10); document.body.style.overflow = 'hidden'; } 
            else { p.classList.add('translate-x-full'); setTimeout(() => { m.classList.add('hidden'); document.body.style.overflow = ''; }, 300); }
        };
        window.openCustomerForm = () => { window.toggleCart(); document.getElementById('customer-modal').classList.remove('hidden'); };
        window.closeCustomerForm = () => document.getElementById('customer-modal').classList.add('hidden');
        window.closePayment = () => document.getElementById('payment-modal').classList.add('hidden');
        window.clearCartAndClose = () => { cart = []; updateCartUI(); window.closePayment(); };
        window.copyUPI = () => {
            navigator.clipboard.writeText("swastik.farms724@kotak");
            const t = document.getElementById('toast'); t.classList.remove('opacity-0'); setTimeout(() => t.classList.add('opacity-0'), 2000);
        };

        let cart = [];
        let customerData = {};
        
        // Products with updated images
        const products = [
            { id: 1, name: "Fresh Farm Milk", description: "Pure, unprocessed raw milk.", image: "image_465efc.png", variants: [{ size: "1 Liter", price: 99 }, { size: "500 ml", price: 50 }], tag: "Best Seller" },
            { id: 2, name: "Buffalo Ghee", description: "Traditional Bilona method.", image: "buffalo ghee.jpg", variants: [{ size: "1 Kg", price: 1699 }, { size: "500 gm", price: 799 }, { size: "250 gm", price: 425 }], tag: "Premium" },
            { id: 3, name: "Desi Cow Ghee", description: "A2 milk, golden nutritious.", image: "cow ghee.webp", variants: [{ size: "1 Kg", price: 2999 }, { size: "500 ml", price: 1599 }, { size: "250 ml", price: 899 }], tag: "Superfood" },
            { id: 4, name: "Fresh Curd (Dahi)", description: "Thick, creamy set curd.", image: "dahi.webp", variants: [{ size: "1 Kg", price: 140 }, { size: "500 gm", price: 75 }, { size: "250 gm", price: 40 }], tag: "Fresh" },
            { id: 5, name: "Village Lassi", description: "Refreshing traditional drink.", image: "image_4661bf.png", variants: [{ size: "1 Liter", price: 45 }, { size: "500 ml", price: 25 }, { size: "100 ml", price: 8 }], tag: "Cooling" }
        ];

        window.submitCustomerDetails = async (e) => {
            e.preventDefault();
            const spinner = document.getElementById('loading-spinner');
            const btn = document.getElementById('submit-btn');
            
            spinner.classList.remove('hidden');
            btn.disabled = true;

            const newOrder = {
                name: document.getElementById('cust-name').value,
                phone: document.getElementById('cust-phone').value,
                address: document.getElementById('cust-address').value,
                items: cart,
                total: cart.reduce((sum, i) => sum + (i.price * i.qty), 0),
                status: 'Payment Pending',
                createdAt: new Date().toISOString()
            };

            try {
                if (!db) throw new Error("DB Offline");
                // Save Order to Firebase
                const docRef = await addDoc(collection(db, `artifacts/${appId}/public/data/orders`), newOrder);
                customerData = { ...newOrder, orderId: docRef.id.substring(0, 6).toUpperCase() };
                
                // Update Modal UI
                document.getElementById('payment-total').innerText = `â‚¹${customerData.total}`;
                document.getElementById('display-order-id').innerText = `#${customerData.orderId}`;
                
                const link = `upi://pay?pa=swastik.farms724@kotak&pn=Swastik%20Dairy&am=${customerData.total}&cu=INR`;
                ['btn-gpay','btn-phonepe','btn-paytm','btn-bhim'].forEach(id => document.getElementById(id).href = link);

                let msg = `*ðŸ§¾ NEW ORDER #${customerData.orderId}*\n\n`;
                msg += `ðŸ‘¤ *Name:* ${customerData.name}\nðŸ“ž *Phone:* ${customerData.phone}\nðŸ“ *Addr:* ${customerData.address}\n\n`;
                customerData.items.forEach(i => msg += `â–ªï¸ ${i.name} (${i.size}) x ${i.qty}\n`);
                msg += `\nðŸ’° *TOTAL: â‚¹${customerData.total}*\n\nâœ… *Status:* Paid Online\nðŸ“Ž *ATTACHED:* Payment Screenshot`;
                
                document.getElementById('whatsapp-confirm').href = `https://wa.me/919812186467?text=${encodeURIComponent(msg)}`;

                window.closeCustomerForm();
                document.getElementById('payment-modal').classList.remove('hidden');
            } catch (err) {
                alert("Order failed. Please check internet connection.");
                console.error(err);
            } finally {
                spinner.classList.add('hidden');
                btn.disabled = false;
            }
        };

        function renderProducts() {
            return products.map((p, i) => `
                <div class="bg-white rounded-3xl border border-gray-100 overflow-hidden product-card flex flex-col h-full relative group">
                    ${p.tag ? `<div class="absolute top-4 left-4 bg-white/90 backdrop-blur text-farm-green text-[10px] font-bold px-3 py-1 rounded-full z-10 border border-green-100 shadow-sm">${p.tag}</div>` : ''}
                    <div class="relative w-full pt-[80%] bg-gray-50">
                        <img src="${p.image}" class="absolute top-0 left-0 w-full h-full object-contain p-4 group-hover:scale-110 transition duration-500">
                    </div>
                    <div class="p-6 flex flex-col flex-grow">
                        <h3 class="text-xl font-bold text-gray-900 mb-1 font-serif">${p.name}</h3>
                        <p class="text-gray-500 text-sm mb-4 line-clamp-2">${p.description}</p>
                        <div class="mt-auto">
                            <div class="flex flex-wrap gap-2 mb-4" id="variants-${i}">
                                ${p.variants.map((v, vIndex) => `<button onclick="selectVariant(${i}, ${vIndex})" class="variant-btn-${i} px-3 py-1 text-xs border rounded-lg transition ${vIndex===0?'border-farm-green bg-green-50 text-farm-green font-bold':'border-gray-200 text-gray-500'}" data-price="${v.price}">${v.size}</button>`).join('')}
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-2xl font-bold text-gray-900" id="price-${i}">â‚¹${p.variants[0].price}</span>
                                <button onclick="addToCart(${i})" class="bg-gray-900 hover:bg-farm-green text-white w-10 h-10 rounded-full flex items-center justify-center shadow-lg transition transform active:scale-95"><i class="fa-solid fa-plus"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        window.selectVariant = (pIndex, vIndex) => {
            document.querySelectorAll(`.variant-btn-${pIndex}`).forEach((b, idx) => b.className = idx === vIndex ? 'variant-btn-'+pIndex+' px-3 py-1 text-xs border rounded-lg transition border-farm-green bg-green-50 text-farm-green font-bold' : 'variant-btn-'+pIndex+' px-3 py-1 text-xs border rounded-lg transition border-gray-200 text-gray-500');
            document.getElementById(`price-${pIndex}`).innerText = `â‚¹${products[pIndex].variants[vIndex].price}`;
            selectedVariants[pIndex] = vIndex;
        };

        let selectedVariants = {};
        window.addToCart = (i) => {
            const vIdx = selectedVariants[i] || 0;
            const p = products[i];
            const v = p.variants[vIdx];
            const exist = cart.find(x => x.id === p.id && x.size === v.size);
            if (exist) exist.qty++; else cart.push({ id: p.id, name: p.name, price: v.price, size: v.size, image: p.image, qty: 1 });
            updateCartUI();
            const b = document.getElementById('cart-count'); b.classList.remove('animate-pop'); void b.offsetWidth; b.classList.add('animate-pop');
        };

        function updateCartUI() {
            document.getElementById('cart-count').innerText = cart.reduce((a, b) => a + b.qty, 0);
            document.getElementById('cart-total').innerText = `â‚¹${cart.reduce((a, b) => a + (b.price * b.qty), 0)}`;
            document.getElementById('checkout-btn').disabled = cart.length === 0;
            const container = document.getElementById('cart-items');
            if (cart.length === 0) container.innerHTML = `<div class="text-center mt-20 text-gray-400"><i class="fa-solid fa-basket-shopping text-3xl mb-2"></i><p>Cart is empty</p></div>`;
            else container.innerHTML = cart.map((x, idx) => `
                <div class="flex gap-4 p-2 border border-gray-100 rounded-xl">
                    <img src="${x.image}" class="w-16 h-16 object-cover rounded-lg bg-gray-50">
                    <div class="flex-grow">
                        <div class="flex justify-between"><h4 class="font-bold text-sm">${x.name}</h4><button onclick="cart.splice(${idx},1);updateCartUI()" class="text-red-400 text-xs"><i class="fa-solid fa-trash"></i></button></div>
                        <p class="text-xs text-gray-500">${x.size}</p>
                        <div class="flex justify-between items-center mt-2">
                            <div class="flex items-center border rounded-lg"><button onclick="if(cart[${idx}].qty>1)cart[${idx}].qty--;else cart.splice(${idx},1);updateCartUI()" class="px-2 text-gray-500">-</button><span class="text-xs font-bold px-1">${x.qty}</span><button onclick="cart[${idx}].qty++;updateCartUI()" class="px-2 text-gray-500">+</button></div>
                            <span class="font-bold text-sm">â‚¹${x.price * x.qty}</span>
                        </div>
                    </div>
                </div>`).join('');
        }
    </script>
</body>
</html>
